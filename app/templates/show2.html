<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSH ëª…ë ¹ì–´ ì‹¤í–‰ê¸° (ì„¸ì…˜ ì§€ì›)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .result-box.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .result-box.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .result-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-success {
            background: #28a745;
            color: white;
        }
        
        .status-error {
            background: #dc3545;
            color: white;
        }
        
        .result-content {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .server-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .server-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            transition: border-color 0.3s ease, transform 0.2s ease;
            cursor: pointer;
        }
        
        .server-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .server-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .server-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 5px;
        }
        
        .server-info {
            color: #666;
            font-size: 0.9em;
        }
        
        .session-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .session-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .session-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
        }
        
        .session-detail {
            background: white;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .session-detail strong {
            color: #333;
        }
        
        .command-history {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .history-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-command {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .history-timestamp {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .history-result {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            background: #f1f3f4;
            padding: 8px;
            border-radius: 4px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #e1e5e9;
        }
        
        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .session-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .no-session {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        /* í„°ë¯¸ë„ ìŠ¤íƒ€ì¼ */
        .terminal-container {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            height: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .terminal-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            margin: 0;
            border-radius: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .terminal-container.fullscreen .terminal-output {
            font-size: 14px;
            line-height: 1.2;
        }
        
        .terminal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #00ff88;
            font-size: 14px;
        }
        
        .terminal-controls-header {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .terminal-fullscreen-btn {
            background: #333;
            border: 1px solid #555;
            color: #00ff88;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .terminal-fullscreen-btn:hover {
            background: #555;
        }
        
        .terminal-output {
            flex: 1;
            background: #000;
            color: #00ff88;
            padding: 15px;
            border-radius: 4px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.1;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .terminal-input {
            display: flex;
            align-items: center;
            margin-top: 5px;
            background: #000;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .terminal-prompt {
            color: #00ff88;
            margin-right: 8px;
            font-weight: bold;
            font-size: 13px;
        }
        
        .terminal-command {
            flex: 1;
            background: transparent;
            border: none;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            outline: none;
            line-height: 1.1;
        }
        
        .terminal-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .terminal-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-connected {
            background-color: #00ff00;
        }
        
        .status-disconnected {
            background-color: #ff0000;
        }
        
        .status-shell {
            background-color: #ffaa00;
        }

        .terminal-hint {
            margin-left: auto;
            font-size: 12px;
            color: #666;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ SSH ëª…ë ¹ì–´ ì‹¤í–‰ê¸° (ì„¸ì…˜ ì§€ì›)</h1>
            <p>ì›ê²© ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš” - ì§€ì†ì ì¸ ì„¸ì…˜ ì—°ê²° ì§€ì›</p>
        </div>
        
        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('session')">ì„¸ì…˜ ëª¨ë“œ</button>
                <button class="tab" onclick="showTab('terminal')">ğŸ–¥ï¸ í„°ë¯¸ë„</button>
                <button class="tab" onclick="showTab('single')">ë‹¨ì¼ ëª…ë ¹ì–´</button>
                <button class="tab" onclick="showTab('batch')">ë°°ì¹˜ ëª…ë ¹ì–´</button>
                <button class="tab" onclick="showTab('servers')">ì„œë²„ ê´€ë¦¬</button>
                <button class="tab" onclick="showTab('security')">ğŸ›¡ï¸ ë³´ì•ˆ</button>
            </div>
            
            <!-- ì„¸ì…˜ ëª¨ë“œ íƒ­ -->
            <div id="session" class="tab-content active">
                <div class="form-section">
                    <h3>SSH ì„¸ì…˜ ê´€ë¦¬</h3>
                    
                    <div id="sessionInfo" style="display: none;">
                        <div class="session-info">
                            <h4>ğŸ”„ í™œì„± ì„¸ì…˜</h4>
                            <div class="session-details" id="sessionDetails">
                                <!-- ì„¸ì…˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                            <div class="session-controls">
                                <button class="btn btn-danger" onclick="closeSession()">ì„¸ì…˜ ì¢…ë£Œ</button>
                                <button class="btn btn-secondary" onclick="refreshSessionInfo()">ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noSession" class="no-session">
                        <h4>ğŸ“¡ SSH ì„¸ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”</h4>
                        <p>ì„œë²„ë¥¼ ì„ íƒí•˜ê³  ì„¸ì…˜ì„ ìƒì„±í•˜ì—¬ ì§€ì†ì ì¸ ëª…ë ¹ì–´ ì‹¤í–‰ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="form-section">
                        <h3>ì„œë²„ ì„ íƒ</h3>
                        <div id="serverList" class="server-list">
                            <!-- ì„œë²„ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>ì„¸ì…˜ ëª…ë ¹ì–´ ì‹¤í–‰</h3>
                        <div class="form-group">
                            <label for="sessionCommand">ì‹¤í–‰í•  ëª…ë ¹ì–´:</label>
                            <input type="text" id="sessionCommand" class="form-control" placeholder="ì˜ˆ: ls -la /home" value="pwd" onkeydown="if(event.key === 'Enter') { executeInSession(); }">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sessionTimeout">íƒ€ì„ì•„ì›ƒ (ì´ˆ):</label>
                                <input type="number" id="sessionTimeout" class="form-control" value="30" min="5" max="300">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="useMasterKey" checked>
                                    ë§ˆìŠ¤í„°í‚¤ ì‚¬ìš©
                                </label>
                            </div>
                        </div>
                        
                        <div class="session-controls">
                            <button class="btn btn-success" onclick="createSession()" id="createSessionBtn">ì„¸ì…˜ ìƒì„±</button>
                            <button class="btn" onclick="executeInSession()" id="executeSessionBtn" style="display: none;">ëª…ë ¹ì–´ ì‹¤í–‰</button>
                        </div>
                    </div>
                    
                    <div id="sessionHistory" class="command-history" style="display: none;">
                        <h4>ğŸ“œ ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬</h4>
                        <div id="historyList">
                            <!-- ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- í„°ë¯¸ë„ íƒ­ -->
            <div id="terminal" class="tab-content">
                <div class="form-section">
                    <h3>ğŸ–¥ï¸ ëŒ€í™”í˜• í„°ë¯¸ë„</h3>
                    
                    <div class="terminal-status">
                        <div>
                            <span class="status-indicator status-disconnected" id="connectionStatus"></span>
                            <span id="connectionText">ì—°ê²° ì•ˆë¨</span>
                        </div>
                        <div>
                            <span class="status-indicator status-disconnected" id="shellStatus"></span>
                            <span id="shellText">ì‰˜ ë¹„í™œì„±</span>
                        </div>
                        <div id="sessionInfo">ì„¸ì…˜: ì—†ìŒ</div>
                    </div>
                    
                    <div class="terminal-controls">
                        <select id="terminalServerSelect" class="form-select">
                            <option value="">ì„œë²„ ì„ íƒ...</option>
                        </select>
                        <button id="startTerminalBtn" class="btn btn-primary" onclick="startTerminal()">í„°ë¯¸ë„ ì‹œì‘</button>
                        <button id="stopTerminalBtn" class="btn btn-danger" onclick="stopTerminal()" style="display:none;">í„°ë¯¸ë„ ì¢…ë£Œ</button>
                        <div class="terminal-hint">
                            ğŸ’¡ ESC: ì „ì²´í™”ë©´ ì¢…ë£Œ | â†‘â†“: ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ | Tab: ìë™ì™„ì„±
                        </div>
                    </div>
                    
                    <div class="terminal-container" id="terminalContainer">
                        <div class="terminal-header">
                            <span>SSH Terminal</span>
                            <div class="terminal-controls-header">
                                <span id="currentPrompt">$</span>
                                <button class="terminal-fullscreen-btn" onclick="toggleTerminalFullscreen()" title="ì „ì²´í™”ë©´ í† ê¸€">
                                    <span id="fullscreenIcon">â›¶</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="terminal-output" id="terminalOutput">
                            í„°ë¯¸ë„ì„ ì‹œì‘í•˜ë ¤ë©´ ì„œë²„ë¥¼ ì„ íƒí•˜ê³  'í„°ë¯¸ë„ ì‹œì‘' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                        </div>
                        
                        <div class="terminal-input">
                            <span class="terminal-prompt" id="terminalPrompt">$</span>
                            <input type="text" class="terminal-command" id="terminalCommand" 
                                   placeholder="ëª…ë ¥ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                                   onkeydown="handleTerminalKey(event)" disabled>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë‹¨ì¼ ëª…ë ¹ì–´ íƒ­ -->
            <div id="single" class="tab-content">
                <div class="form-section">
                    <h3>ì„œë²„ ì„ íƒ</h3>
                    <div id="serverListSingle" class="server-list">
                        <!-- ì„œë²„ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>ëª…ë ¹ì–´ ì‹¤í–‰</h3>
                    <div class="form-group">
                        <label for="command">ì‹¤í–‰í•  ëª…ë ¹ì–´:</label>
                        <input type="text" id="command" class="form-control" placeholder="ì˜ˆ: ls -la /home" value="ls -la" onkeydown="if(event.key === 'Enter') { executeCommand(); }">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timeout">íƒ€ì„ì•„ì›ƒ (ì´ˆ):</label>
                            <input type="number" id="timeout" class="form-control" value="30" min="5" max="300">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="useMasterKeySingle" checked>
                                ë§ˆìŠ¤í„°í‚¤ ì‚¬ìš©
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="executeCommand()">ëª…ë ¹ì–´ ì‹¤í–‰</button>
                </div>
            </div>
            
            <!-- ë°°ì¹˜ ëª…ë ¹ì–´ íƒ­ -->
            <div id="batch" class="tab-content">
                <div class="form-section">
                    <h3>ë°°ì¹˜ ëª…ë ¹ì–´ ì‹¤í–‰</h3>
                    <div class="form-group">
                        <label for="batchCommand">ëª¨ë“  ì„œë²„ì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì–´:</label>
                        <input type="text" id="batchCommand" class="form-control" placeholder="ì˜ˆ: df -h" value="df -h">
                    </div>
                    
                    <div class="form-group">
                        <label for="batchTimeout">íƒ€ì„ì•„ì›ƒ (ì´ˆ):</label>
                        <input type="number" id="batchTimeout" class="form-control" value="30" min="5" max="300">
                    </div>
                    
                    <button class="btn" onclick="executeBatchCommand()">ë°°ì¹˜ ì‹¤í–‰</button>
                </div>
            </div>
            
            <!-- ì„œë²„ ê´€ë¦¬ íƒ­ -->
            <div id="servers" class="tab-content">
                <div class="form-section">
                    <h3>ì„œë²„ ì •ë³´</h3>
                    <div id="serverInfo">
                        <!-- ì„œë²„ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
            
            <!-- ë³´ì•ˆ íƒ­ -->
            <div id="security" class="tab-content">
                <div class="form-section">
                    <h3>ğŸ›¡ï¸ ë³´ì•ˆ í˜„í™©</h3>
                    <div class="security-stats" id="securityStats">
                        <div class="result-box">
                            <h4>ë³´ì•ˆ í†µê³„</h4>
                            <div id="securityStatsContent">ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>ğŸš« ì°¨ë‹¨ëœ ëª…ë ¹ì–´ ì´ë²¤íŠ¸</h3>
                    <div class="security-controls" style="margin-bottom: 15px;">
                        <button class="btn" onclick="loadSecurityEvents()">ìµœì‹  ì´ë²¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button class="btn btn-secondary" onclick="testSecuritySystem()">ë³´ì•ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
                    </div>
                    <div class="security-events" id="securityEvents">
                        <div class="result-box">
                            <h4>ìµœê·¼ ì°¨ë‹¨ëœ ëª…ë ¹ì–´ë“¤</h4>
                            <div id="securityEventsContent">ë³´ì•ˆ ì´ë²¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>ğŸ§ª ë³´ì•ˆ í…ŒìŠ¤íŠ¸</h3>
                    <div id="securityTestResults">
                        <!-- ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
            
            <div class="result-section" id="resultSection">
                <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // API ê¸°ë³¸ URL ì„¤ì • (ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©)
        const API_BASE = '/ssh';
        
        let selectedServer = null;
        let servers = [];
        let currentSessionId = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        // ì „ì²´í™”ë©´ í† ê¸€ í•¨ìˆ˜
        function toggleTerminalFullscreen() {
            const container = document.getElementById('terminalContainer');
            const icon = document.getElementById('fullscreenIcon');
            
            if (container.classList.contains('fullscreen')) {
                container.classList.remove('fullscreen');
                icon.textContent = 'â›¶';
                document.body.style.overflow = '';
            } else {
                container.classList.add('fullscreen');
                icon.textContent = 'â›·';
                document.body.style.overflow = 'hidden';
            }
        }

        // ESC í‚¤ë¡œ ì „ì²´í™”ë©´ ì¢…ë£Œ
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const container = document.getElementById('terminalContainer');
                if (container.classList.contains('fullscreen')) {
                    toggleTerminalFullscreen();
                }
            }
        });

        // í”„ë¡¬í”„íŠ¸ì—ì„œ HTML íƒœê·¸ ì œê±°í•˜ëŠ” í•¨ìˆ˜
        function sanitizePrompt(prompt) {
            if (!prompt) return '$';
            // HTML íƒœê·¸ ì œê±°í•˜ê³  ìƒ‰ìƒ ì½”ë“œë„ ì œê±°
            return prompt.replace(/<[^>]*>/g, '').replace(/\x1b\[[0-9;]*m/g, '').trim() || '$';
        }

        // ì¶œë ¥ì—ì„œ ANSI ì œì–´ ì‹œí€€ìŠ¤ ë° HTML íƒœê·¸ë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜
        function sanitizeOutput(text) {
            if (!text) return '';
            // 1) OSC / CSI / ê¸°íƒ€ ANSI ì‹œí€€ìŠ¤ ì œê±°
            const ansiRegex = /\x1b(?:[@-Z\\-_]|\[[0-?]*[ -/]*[@-~]|\].*?\x07)/g;
            // 2) HTML íƒœê·¸ ì œê±° (<span ...>)
            const htmlRegex = /<[^>]*>/g;
            return text.replace(ansiRegex, '').replace(htmlRegex, '');
        }

        window.onload = function() {
            loadServers();
        };
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // ì„¸ì…˜ íƒ­ìœ¼ë¡œ ì´ë™ ì‹œ ì„¸ì…˜ ì •ë³´ ìƒˆë¡œê³ ì¹¨
            if (tabName === 'session') {
                if (currentSessionId) {
                    refreshSessionInfo();
                }
            }
        }
        
        // ì„œë²„ ëª©ë¡ ë¡œë“œ
        async function loadServers() {
            try {
                const response = await fetch(`${API_BASE}/servers`);
                const data = await response.json();
                servers = data.servers || [];
                
                displayServers();
                displayServerInfo();
                return servers; // í„°ë¯¸ë„ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë°˜í™˜
            } catch (error) {
                console.error('ì„œë²„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('ì„œë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. SSH Executor ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return [];
            }
        }
        
        // ì„œë²„ ëª©ë¡ í‘œì‹œ
        function displayServers() {
            const serverList = document.getElementById('serverList');
            const serverListSingle = document.getElementById('serverListSingle');
            
            [serverList, serverListSingle].forEach(container => {
                if (container) {
                    container.innerHTML = '';
                    
                    servers.forEach(server => {
                        const serverCard = document.createElement('div');
                        serverCard.className = 'server-card';
                        serverCard.onclick = () => selectServer(server);
                        
                        let serverTypeIcon = '';
                        if (server.name.includes('web')) {
                            serverTypeIcon = 'ğŸŒ';
                        } else if (server.name.includes('db')) {
                            serverTypeIcon = 'ğŸ—„ï¸';
                        } else if (server.name.includes('app')) {
                            serverTypeIcon = 'ğŸ“±';
                        } else if (server.name.includes('name')) {
                            serverTypeIcon = 'ğŸ“›';
                        }
                        
                        serverCard.innerHTML = `
                            <div class="server-name">${serverTypeIcon} ${server.name}</div>
                            <div class="server-info">
                                <div><strong>í˜¸ìŠ¤íŠ¸:</strong> ${server.host}:${server.port}</div>
                                <div><strong>ì‚¬ìš©ì:</strong> ${server.username}</div>
                                <div><strong>ì„¤ëª…:</strong> ${server.description}</div>
                            </div>
                        `;
                        
                        container.appendChild(serverCard);
                    });
                }
            });
        }
        
        // ì„œë²„ ì„ íƒ
        function selectServer(server) {
            selectedServer = server;
            
            // ëª¨ë“  ì„œë²„ ì¹´ë“œì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
            document.querySelectorAll('.server-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ì„ íƒëœ ì„œë²„ ì¹´ë“œì— ì„ íƒ ìƒíƒœ ì¶”ê°€
            event.target.closest('.server-card').classList.add('selected');
        }
        
        // ì„¸ì…˜ ìƒì„±
        async function createSession() {
            if (!selectedServer) {
                showError('ì„¸ì…˜ì„ ìƒì„±í•  ì„œë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/session/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        host: selectedServer.host,
                        port: selectedServer.port,
                        username: selectedServer.username,
                        timeout: parseInt(document.getElementById('sessionTimeout').value),
                        use_master_key: document.getElementById('useMasterKey').checked
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentSessionId = result.session_id;
                    showSessionInfo();
                    showSuccess(`ì„¸ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${result.session_id}`);
                } else {
                    showError(`ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: ${result.message}`);
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨:', error);
                showError('ì„¸ì…˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ì„¸ì…˜ ë‚´ì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰
        async function executeInSession() {
            if (!currentSessionId) {
                showError('í™œì„± ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì„¸ì…˜ì„ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const command = document.getElementById('sessionCommand').value.trim();
            if (!command) {
                showError('ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/session/${currentSessionId}/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        command: command,
                        timeout: parseInt(document.getElementById('sessionTimeout').value)
                    })
                });
                
                const result = await response.json();
                displaySessionResult(result);
                refreshSessionInfo();
            } catch (error) {
                console.error('ì„¸ì…˜ ëª…ë ¹ì–´ ì‹¤í–‰ ì‹¤íŒ¨:', error);
                showError('ì„¸ì…˜ ëª…ë ¹ì–´ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ì„¸ì…˜ ì¢…ë£Œ
        async function closeSession() {
            if (!currentSessionId) {
                showError('ì¢…ë£Œí•  ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/session_delete/${currentSessionId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showSuccess('ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    hideSessionInfo();
                    currentSessionId = null;
                } else {
                    showError('ì„¸ì…˜ ì¢…ë£Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì¢…ë£Œ ì‹¤íŒ¨:', error);
                showError('ì„¸ì…˜ ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì„¸ì…˜ ì •ë³´ í‘œì‹œ
        function showSessionInfo() {
            document.getElementById('noSession').style.display = 'none';
            document.getElementById('sessionInfo').style.display = 'block';
            document.getElementById('createSessionBtn').style.display = 'none';
            document.getElementById('executeSessionBtn').style.display = 'inline-block';
            document.getElementById('sessionHistory').style.display = 'block';
            
            refreshSessionInfo();
        }
        
        // ì„¸ì…˜ ì •ë³´ ìˆ¨ê¹€
        function hideSessionInfo() {
            document.getElementById('noSession').style.display = 'block';
            document.getElementById('sessionInfo').style.display = 'none';
            document.getElementById('createSessionBtn').style.display = 'inline-block';
            document.getElementById('executeSessionBtn').style.display = 'none';
            document.getElementById('sessionHistory').style.display = 'none';
        }
        
        // ì„¸ì…˜ ì •ë³´ ìƒˆë¡œê³ ì¹¨
        async function refreshSessionInfo() {
            if (!currentSessionId) return;
            
            try {
                const response = await fetch(`${API_BASE}/session/${currentSessionId}`);
                const sessionInfo = await response.json();
                
                const sessionDetails = document.getElementById('sessionDetails');
                const connectionStatus = sessionInfo.is_connected ? 'ğŸŸ¢ ì—°ê²°ë¨' : 'ğŸ”´ ì—°ê²° ëŠê¹€';
                const activeStatus = sessionInfo.is_active ? 'ğŸŸ¢ í™œì„±' : 'ğŸŸ¡ ë¹„í™œì„±';
                
                sessionDetails.innerHTML = `
                    <div class="session-detail">
                        <strong>ì„¸ì…˜ ID:</strong> ${sessionInfo.session_id.substring(0, 8)}...
                    </div>
                    <div class="session-detail">
                        <strong>í˜¸ìŠ¤íŠ¸:</strong> ${sessionInfo.host}
                    </div>
                    <div class="session-detail">
                        <strong>ì‚¬ìš©ì:</strong> ${sessionInfo.username}
                    </div>
                    <div class="session-detail">
                        <strong>ì—°ê²° ìƒíƒœ:</strong> ${connectionStatus}
                    </div>
                    <div class="session-detail">
                        <strong>í™œì„± ìƒíƒœ:</strong> ${activeStatus}
                    </div>
                    <div class="session-detail">
                        <strong>ìƒì„± ì‹œê°„:</strong> ${new Date(sessionInfo.created_at).toLocaleString()}
                    </div>
                    <div class="session-detail">
                        <strong>ë§ˆì§€ë§‰ í™œë™:</strong> ${new Date(sessionInfo.last_activity).toLocaleString()}
                    </div>
                    <div class="session-detail">
                        <strong>ëª…ë ¹ì–´ ìˆ˜:</strong> ${sessionInfo.command_count}
                    </div>
                `;
                
                // ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ í‘œì‹œ
                displayCommandHistory();
            } catch (error) {
                console.error('ì„¸ì…˜ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }
        
        // ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ í‘œì‹œ
        async function displayCommandHistory() {
            if (!currentSessionId) return;
            
            try {
                const response = await fetch(`${API_BASE}/session/${currentSessionId}`);
                const sessionInfo = await response.json();
                
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                
                if (sessionInfo.command_history && sessionInfo.command_history.length > 0) {
                    sessionInfo.command_history.forEach(item => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';
                        
                        const statusClass = item.result.success ? 'status-success' : 'status-error';
                        const statusText = item.result.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                        
                        historyItem.innerHTML = `
                            <div class="history-command">${item.command}</div>
                            <div class="history-timestamp">${new Date(item.timestamp).toLocaleString()}</div>
                            <div class="history-result">
                                <span class="result-status ${statusClass}">${statusText}</span>
                                ${item.result.stdout ? `<br>ì¶œë ¥: ${item.result.stdout}` : ''}
                                ${item.result.stderr ? `<br>ì˜¤ë¥˜: ${item.result.stderr}` : ''}
                            </div>
                        `;
                        
                        historyList.appendChild(historyItem);
                    });
                } else {
                    historyList.innerHTML = '<p>ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
                historyList.innerHTML = '<p>íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // ì„¸ì…˜ ê²°ê³¼ í‘œì‹œ
        function displaySessionResult(result) {
            const resultSection = document.getElementById('resultSection');
            const resultBox = document.createElement('div');
            
            // ë³´ì•ˆ ì°¨ë‹¨ëœ ëª…ë ¹ì–´ ì²˜ë¦¬
            if (result.blocked) {
                resultBox.className = 'result-box error';
                resultBox.innerHTML = `
                    <div class="result-header">
                        <strong>ğŸš« ë³´ì•ˆ ì°¨ë‹¨</strong>
                        <span class="result-status status-error">ì°¨ë‹¨ë¨</span>
                    </div>
                    <div class="result-content">
ëª…ë ¹ì–´: ${result.command || 'ì•Œ ìˆ˜ ì—†ìŒ'}
ì°¨ë‹¨ ì‚¬ìœ : ${result.error || 'ë³´ì•ˆ ì •ì±… ìœ„ë°˜'}
ì¹´í…Œê³ ë¦¬: ${result.category || 'ë¯¸ë¶„ë¥˜'}

ì´ ëª…ë ¹ì–´ëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì‹¤í–‰ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
                resultSection.insertBefore(resultBox, resultSection.firstChild);
                return;
            }
            
            resultBox.className = `result-box ${result.success ? 'success' : 'error'}`;
            
            const statusClass = result.success ? 'status-success' : 'status-error';
            const statusText = result.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
            
            resultBox.innerHTML = `
                <div class="result-header">
                    <strong>ì„¸ì…˜ ëª…ë ¹ì–´ ì‹¤í–‰</strong>
                    <span class="result-status ${statusClass}">${statusText}</span>
                </div>
                <div class="result-content">
ëª…ë ¹ì–´: ${result.command}
ì¢…ë£Œ ì½”ë“œ: ${result.exit_code}

ì¶œë ¥:
${result.stdout || '(ì¶œë ¥ ì—†ìŒ)'}

ì˜¤ë¥˜:
${result.stderr || '(ì˜¤ë¥˜ ì—†ìŒ)'}
${result.error ? '\nì˜¤ë¥˜ ë©”ì‹œì§€: ' + result.error : ''}
                </div>
            `;
            
            resultSection.insertBefore(resultBox, resultSection.firstChild);
        }
        
        // ì„œë²„ ì •ë³´ í‘œì‹œ
        function displayServerInfo() {
            const serverInfo = document.getElementById('serverInfo');
            serverInfo.innerHTML = `
                <div class="result-box">
                    <h4>ë“±ë¡ëœ ì„œë²„ (${servers.length}ê°œ)</h4>
                    <div class="result-content">
${servers.map(server => `${server.name}:
  í˜¸ìŠ¤íŠ¸: ${server.host}:${server.port}
  ì‚¬ìš©ì: ${server.username}
  ì„¤ëª…: ${server.description}
`).join('\n')}
                    </div>
                </div>
            `;
        }
        
        // ë‹¨ì¼ ëª…ë ¹ì–´ ì‹¤í–‰
        async function executeCommand() {
            if (!selectedServer) {
                showError('ì‹¤í–‰í•  ì„œë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const command = document.getElementById('command').value.trim();
            if (!command) {
                showError('ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch('https://runmcp.hankyeul.com/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        host: selectedServer.host,
                        port: selectedServer.port,
                        username: selectedServer.username,
                        command: command,
                        timeout: parseInt(document.getElementById('timeout').value),
                        use_master_key: document.getElementById('useMasterKeySingle').checked
                    })
                });
                
                const result = await response.json();
                displayResult(result);
            } catch (error) {
                console.error('ëª…ë ¹ì–´ ì‹¤í–‰ ì‹¤íŒ¨:', error);
                showError('ëª…ë ¹ì–´ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ë°°ì¹˜ ëª…ë ¹ì–´ ì‹¤í–‰
        async function executeBatchCommand() {
            const command = document.getElementById('batchCommand').value.trim();
            if (!command) {
                showError('ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (servers.length === 0) {
                showError('ì‹¤í–‰í•  ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            showLoading(true);
            
            try {
                const requests = servers.map(server => ({
                    host: server.host,
                    port: server.port,
                    username: server.username,
                    command: command,
                    timeout: parseInt(document.getElementById('batchTimeout').value),
                    use_master_key: true
                }));
                
                const response = await fetch('https://runmcp.hankyeul.com/execute-batch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requests)
                });
                
                const result = await response.json();
                displayBatchResults(result.results);
            } catch (error) {
                console.error('ë°°ì¹˜ ëª…ë ¹ì–´ ì‹¤í–‰ ì‹¤íŒ¨:', error);
                showError('ë°°ì¹˜ ëª…ë ¹ì–´ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function displayResult(result) {
            const resultSection = document.getElementById('resultSection');
            const resultBox = document.createElement('div');
            resultBox.className = `result-box ${result.success ? 'success' : 'error'}`;
            
            const statusClass = result.success ? 'status-success' : 'status-error';
            const statusText = result.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
            
            resultBox.innerHTML = `
                <div class="result-header">
                    <strong>${selectedServer.name} (${result.host})</strong>
                    <span class="result-status ${statusClass}">${statusText}</span>
                </div>
                <div class="result-content">
ëª…ë ¹ì–´: ${result.command}
ì¢…ë£Œ ì½”ë“œ: ${result.exit_code}

ì¶œë ¥:
${result.stdout || '(ì¶œë ¥ ì—†ìŒ)'}

ì˜¤ë¥˜:
${result.stderr || '(ì˜¤ë¥˜ ì—†ìŒ)'}
${result.error ? '\nì˜¤ë¥˜ ë©”ì‹œì§€: ' + result.error : ''}
                </div>
            `;
            
            resultSection.insertBefore(resultBox, resultSection.firstChild);
        }
        
        // ë°°ì¹˜ ê²°ê³¼ í‘œì‹œ
        function displayBatchResults(results) {
            const resultSection = document.getElementById('resultSection');
            
            results.forEach(result => {
                const resultBox = document.createElement('div');
                resultBox.className = `result-box ${result.success ? 'success' : 'error'}`;
                
                const statusClass = result.success ? 'status-success' : 'status-error';
                const statusText = result.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                
                resultBox.innerHTML = `
                    <div class="result-header">
                        <strong>${result.host}</strong>
                        <span class="result-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="result-content">
ëª…ë ¹ì–´: ${result.command}
ì¢…ë£Œ ì½”ë“œ: ${result.exit_code}

ì¶œë ¥:
${result.stdout || '(ì¶œë ¥ ì—†ìŒ)'}

ì˜¤ë¥˜:
${result.stderr || '(ì˜¤ë¥˜ ì—†ìŒ)'}
${result.error ? '\nì˜¤ë¥˜ ë©”ì‹œì§€: ' + result.error : ''}
                    </div>
                `;
                
                resultSection.insertBefore(resultBox, resultSection.firstChild);
            });
        }
        
        // ë¡œë”© í‘œì‹œ/ìˆ¨ê¹€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            const resultSection = document.getElementById('resultSection');
            const successBox = document.createElement('div');
            successBox.className = 'result-box success';
            
            successBox.innerHTML = `
                <div class="result-header">
                    <strong>ì„±ê³µ</strong>
                    <span class="result-status status-success">ì„±ê³µ</span>
                </div>
                <div class="result-content">${message}</div>
            `;
            
            resultSection.insertBefore(successBox, resultSection.firstChild);
        }
        
        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const resultSection = document.getElementById('resultSection');
            const errorBox = document.createElement('div');
            errorBox.className = 'result-box error';
            
            errorBox.innerHTML = `
                <div class="result-header">
                    <strong>ì˜¤ë¥˜</strong>
                    <span class="result-status status-error">ì‹¤íŒ¨</span>
                </div>
                <div class="result-content">${message}</div>
            `;
            
            resultSection.insertBefore(errorBox, resultSection.firstChild);
        }
        
        // í„°ë¯¸ë„ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let currentTerminalSession = null;
        let terminalHistory = [];
        let historyIndex = -1;
        
        // í„°ë¯¸ë„ ì‹œì‘
        async function startTerminal() {
            const serverSelect = document.getElementById('terminalServerSelect');
            const selectedServer = serverSelect.value;
            
            if (!selectedServer) {
                alert('ì„œë²„ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const server = JSON.parse(selectedServer);
            
            try {
                // ì„¸ì…˜ ìƒì„±
                const sessionResponse = await fetch(`${API_BASE}/session/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        host: server.host,
                        port: server.port,
                        username: server.username,
                        timeout: 30
                    })
                });
                
                if (!sessionResponse.ok) {
                    throw new Error('ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨');
                }
                
                const sessionData = await sessionResponse.json();
                currentTerminalSession = sessionData.session_id;
                
                // ëŒ€í™”í˜• ì‰˜ ì‹œì‘
                const shellResponse = await fetch(`${API_BASE}/session/${currentTerminalSession}/shell/start`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({})
                });
                
                if (!shellResponse.ok) {
                    throw new Error('ëŒ€í™”í˜• ì‰˜ ì‹œì‘ ì‹¤íŒ¨');
                }
                
                const shellData = await shellResponse.json();
                
                if (shellData.success) {
                    // UI ì—…ë°ì´íŠ¸
                    updateTerminalStatus(true, true);
                    document.getElementById('sessionInfo').textContent = `ì„¸ì…˜: ${currentTerminalSession}`;
                    
                    const output = document.getElementById('terminalOutput');
                    output.textContent = sanitizeOutput(shellData.output) || 'í„°ë¯¸ë„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    
                    if (shellData.prompt) {
                        const cleanPrompt = sanitizePrompt(shellData.prompt);
                        document.getElementById('currentPrompt').textContent = cleanPrompt;
                        document.getElementById('terminalPrompt').textContent = cleanPrompt;
                    }
                    
                    // ëª…ë ¥ì–´ ì…ë ¥ í™œì„±í™”
                    document.getElementById('terminalCommand').disabled = false;
                    document.getElementById('terminalCommand').focus();
                    
                    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    document.getElementById('startTerminalBtn').style.display = 'none';
                    document.getElementById('stopTerminalBtn').style.display = 'inline-block';
                } else {
                    throw new Error(shellData.error || 'ëŒ€í™”í˜• ì‰˜ ì‹œì‘ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('í„°ë¯¸ë„ ì‹œì‘ ì˜¤ë¥˜:', error);
                alert('í„°ë¯¸ë„ ì‹œì‘ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // í„°ë¯¸ë„ ì¢…ë£Œ
        async function stopTerminal() {
            if (!currentTerminalSession) {
                return;
            }
            
            try {
                // ëŒ€í™”í˜• ì‰˜ ì¢…ë£Œ
                await fetch(`${API_BASE}/session/${currentTerminalSession}/shell/stop`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({})
                });
                
                // ì„¸ì…˜ ì¢…ë£Œ
                await fetch(`${API_BASE}/session/${currentTerminalSession}`, {
                    method: 'DELETE'
                });
                
                // UI ì´ˆê¸°í™”
                currentTerminalSession = null;
                updateTerminalStatus(false, false);
                document.getElementById('sessionInfo').textContent = 'ì„¸ì…˜: ì—†ìŒ';
                document.getElementById('terminalOutput').textContent = 'í„°ë¯¸ë„ì„ ì‹œì‘í•˜ë ¤ë©´ ì„œë²„ë¥¼ ì„ íƒí•˜ê³  \'í„°ë¯¸ë„ ì‹œì‘\' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
                document.getElementById('terminalCommand').disabled = true;
                document.getElementById('terminalCommand').value = '';
                
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                document.getElementById('startTerminalBtn').style.display = 'inline-block';
                document.getElementById('stopTerminalBtn').style.display = 'none';
                
            } catch (error) {
                console.error('í„°ë¯¸ë„ ì¢…ë£Œ ì˜¤ë¥˜:', error);
            }
        }
        
        // í„°ë¯¸ë„ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateTerminalStatus(connected, shellActive) {
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionText = document.getElementById('connectionText');
            const shellStatus = document.getElementById('shellStatus');
            const shellText = document.getElementById('shellText');
            
            if (connected) {
                connectionStatus.className = 'status-indicator status-connected';
                connectionText.textContent = 'ì—°ê²°ë¨';
            } else {
                connectionStatus.className = 'status-indicator status-disconnected';
                connectionText.textContent = 'ì—°ê²° ì•ˆë¨';
            }
            
            if (shellActive) {
                shellStatus.className = 'status-indicator status-shell';
                shellText.textContent = 'ì‰˜ í™œì„±';
            } else {
                shellStatus.className = 'status-indicator status-disconnected';
                shellText.textContent = 'ì‰˜ ë¹„í™œì„±';
            }
        }
        
        // í„°ë¯¸ë„ ëª…ë ¥ì–´ ì…ë ¥ ì²˜ë¦¬
        async function handleTerminalKey(event) {
            if (event.key === 'Enter') {
                const command = event.target.value.trim();
                
                if (!command) return;
                if (!currentTerminalSession) {
                    alert('í„°ë¯¸ë„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                terminalHistory.push(command);
                historyIndex = terminalHistory.length;
                
                // ì…ë ¥ í•„ë“œ í´ë¦¬ì–´
                event.target.value = '';
                
                try {
                    const response = await fetch(`${API_BASE}/session/${currentTerminalSession}/shell/command`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ command: command })
                    });
                    
                    if (!response.ok) {
                        throw new Error('ëª…ë ¥ì–´ ì‹¤í–‰ ì‹¤íŒ¨');
                    }
                    
                    const result = await response.json();
                    
                    // í„°ë¯¸ë„ ì¶œë ¥ì— ëª…ë ¥ì–´ì™€ ê²°ê³¼ ì¶”ê°€
                    const output = document.getElementById('terminalOutput');
                    const currentPrompt = document.getElementById('terminalPrompt').textContent;
                    
                    output.textContent += `\n${currentPrompt} ${command}\n`;
                    
                    // ë³´ì•ˆ ì°¨ë‹¨ëœ ëª…ë ¹ì–´ ì²˜ë¦¬
                    if (result.blocked) {
                        output.textContent += `ğŸš« ë³´ì•ˆ ì°¨ë‹¨: ${result.error}\n`;
                        output.textContent += `   ì¹´í…Œê³ ë¦¬: ${result.category}\n`;
                    } else {
                        if (result.output) {
                            output.textContent += sanitizeOutput(result.output);
                        }
                        if (result.error) {
                            output.textContent += `ERROR: ${sanitizeOutput(result.error)}`;
                        }
                    }
                    
                    // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
                    output.scrollTop = output.scrollHeight;
                    
                } catch (error) {
                    console.error('ëª…ë ¥ì–´ ì‹¤í–‰ ì˜¤ë¥˜:', error);
                    const output = document.getElementById('terminalOutput');
                    output.textContent += `\nERROR: ${error.message}\n`;
                    output.scrollTop = output.scrollHeight;
                }
            } else if (event.key === 'ArrowUp') {
                // ëª…ë ¥ì–´ íˆìŠ¤í† ë¦¬ ìœ„ë¡œ
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    event.target.value = terminalHistory[historyIndex];
                }
            } else if (event.key === 'ArrowDown') {
                // ëª…ë ¥ì–´ íˆìŠ¤í† ë¦¬ ì•„ë˜ë¡œ
                event.preventDefault();
                if (historyIndex < terminalHistory.length - 1) {
                    historyIndex++;
                    event.target.value = terminalHistory[historyIndex];
                } else {
                    historyIndex = terminalHistory.length;
                    event.target.value = '';
                }
            } else if (event.key === 'Tab') {
                // íƒ­ ìë™ì™„ì„±
                event.preventDefault();
                await handleTabCompletion(event.target);
            }
        }
        
        // íƒ­ ìë™ì™„ì„± ì²˜ë¦¬
        async function handleTabCompletion(input) {
            const currentValue = input.value;
            const cursorPosition = input.selectionStart;
            const textBeforeCursor = currentValue.substring(0, cursorPosition);
            const textAfterCursor = currentValue.substring(cursorPosition);
            
            // í˜„ì¬ ë‹¨ì–´ ì¶”ì¶œ (ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬)
            const words = textBeforeCursor.split(/\s+/);
            const currentWord = words[words.length - 1];
            
            if (!currentWord) return;
            
            // ë‹¨ì–´ ìœ„ì¹˜ì— ë”°ë¼ ë‹¤ë¥¸ ìë™ì™„ì„± ì „ëµ ì‚¬ìš©
            const isFirstWord = words.length === 1 || (words.length === 2 && words[0] === '');
            
            if (isFirstWord) {
                // ì²« ë²ˆì§¸ ë‹¨ì–´ëŠ” ëª…ë ¹ì–´ ìë™ì™„ì„±
                handleCommandCompletion(input, currentWord, textBeforeCursor, textAfterCursor);
            } else {
                // ë‘ ë²ˆì§¸ ë‹¨ì–´ë¶€í„°ëŠ” íŒŒì¼/ê²½ë¡œ ìë™ì™„ì„± ì‹œë„
                await handleFileCompletion(input, currentWord, textBeforeCursor, textAfterCursor);
            }
        }
        
        // íŒŒì¼/ê²½ë¡œ ìë™ì™„ì„± (ls ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©)
        async function handleFileCompletion(input, currentWord, textBeforeCursor, textAfterCursor) {
            try {
                // ê²½ë¡œ ë¶„ì„
                const hasSlash = currentWord.includes('/');
                const directory = hasSlash ? currentWord.substring(0, currentWord.lastIndexOf('/') + 1) : './';
                const filename = hasSlash ? currentWord.substring(currentWord.lastIndexOf('/') + 1) : currentWord;
                
                // ìˆ¨ê²¨ì§„ ls ëª…ë ¹ì–´ë¡œ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ê²°ê³¼ë§Œ ì‚¬ìš©, ì¶œë ¥ ì•ˆ í•¨)
                const listCommand = `ls -la "${directory}" 2>/dev/null | awk '{print $9}' | grep "^${filename}" | head -10`;
                
                // ë³„ë„ì˜ ì„ì‹œ ì„¸ì…˜ì´ë‚˜ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ì§€ ë§ê³ , ê¸°ë³¸ì ì¸ íŒŒì¼ íŒ¨í„´ ë§¤ì¹­ ì‚¬ìš©
                handleBasicFileCompletion(input, currentWord, textBeforeCursor, textAfterCursor, directory, filename);
                
            } catch (error) {
                // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ëª…ë ¹ì–´ ì™„ì„±ìœ¼ë¡œ ëŒ€ì²´
                handleCommandCompletion(input, currentWord, textBeforeCursor, textAfterCursor);
            }
        }
        
        // ê¸°ë³¸ì ì¸ íŒŒì¼ ìë™ì™„ì„± (ì¼ë°˜ì ì¸ íŒŒì¼/ë””ë ‰í† ë¦¬ íŒ¨í„´)
        function handleBasicFileCompletion(input, currentWord, textBeforeCursor, textAfterCursor, directory, filename) {
            // ì¼ë°˜ì ì¸ íŒŒì¼/ë””ë ‰í† ë¦¬ ì´ë¦„ë“¤
            const commonPaths = [
                './', '../', '~/', '/home/', '/etc/', '/var/', '/usr/', '/tmp/', '/opt/',
                'Desktop/', 'Documents/', 'Downloads/', 'Pictures/', 'Videos/', 'Music/',
                '.bashrc', '.bash_profile', '.zshrc', '.vimrc', '.gitignore', '.env',
                'package.json', 'requirements.txt', 'Dockerfile', 'docker-compose.yml',
                'README.md', 'LICENSE', 'Makefile', 'CMakeLists.txt',
                '.git/', 'node_modules/', '__pycache__/', '.venv/', 'venv/'
            ];
            
            const matches = commonPaths.filter(path => {
                if (directory === './') {
                    return path.toLowerCase().startsWith(filename.toLowerCase());
                } else {
                    const pathName = path.split('/').pop() || path;
                    return pathName.toLowerCase().startsWith(filename.toLowerCase());
                }
            });
            
            if (matches.length === 1) {
                // í•˜ë‚˜ì˜ ë§¤ì¹˜ë§Œ ìˆìœ¼ë©´ ìë™ì™„ì„±
                const suggestion = directory === './' ? matches[0] : directory + matches[0];
                const beforeCurrentWord = textBeforeCursor.substring(0, textBeforeCursor.lastIndexOf(currentWord));
                input.value = beforeCurrentWord + suggestion + textAfterCursor;
                
                // ì»¤ì„œë¥¼ ì™„ì„±ëœ ë‹¨ì–´ ëìœ¼ë¡œ ì´ë™
                const newPosition = beforeCurrentWord.length + suggestion.length;
                input.setSelectionRange(newPosition, newPosition);
            } else if (matches.length > 1) {
                // ì—¬ëŸ¬ ë§¤ì¹˜ê°€ ìˆìœ¼ë©´ ê³µí†µ ì ‘ë‘ì‚¬ë¡œ ì™„ì„±í•˜ê³  ì˜µì…˜ í‘œì‹œ
                const adjustedMatches = directory === './' ? matches : matches.map(m => directory + m);
                const commonPrefix = findCommonPrefix(adjustedMatches);
                
                if (commonPrefix.length > currentWord.length) {
                    const beforeCurrentWord = textBeforeCursor.substring(0, textBeforeCursor.lastIndexOf(currentWord));
                    input.value = beforeCurrentWord + commonPrefix + textAfterCursor;
                    
                    const newPosition = beforeCurrentWord.length + commonPrefix.length;
                    input.setSelectionRange(newPosition, newPosition);
                }
                
                // í„°ë¯¸ë„ì— ì˜µì…˜ë“¤ í‘œì‹œ (ê°„ê²°í•˜ê²Œ)
                const output = document.getElementById('terminalOutput');
                output.textContent += `\n${adjustedMatches.slice(0, 5).join('  ')}${adjustedMatches.length > 5 ? ' ...' : ''}\n`;
                output.scrollTop = output.scrollHeight;
            } else {
                // ë§¤ì¹˜ê°€ ì—†ìœ¼ë©´ ëª…ë ¹ì–´ ì™„ì„± ì‹œë„
                handleCommandCompletion(input, currentWord, textBeforeCursor, textAfterCursor);
            }
        }
        
        // ëª…ë ¹ì–´ ìë™ì™„ì„±
        function handleCommandCompletion(input, currentWord, textBeforeCursor, textAfterCursor) {
            const commonCommands = [
                'ls', 'cd', 'pwd', 'mkdir', 'rmdir', 'cp', 'mv', 'rm', 'cat', 'less', 'more',
                'head', 'tail', 'grep', 'find', 'which', 'whereis', 'man', 'info', 'help',
                'ps', 'top', 'htop', 'kill', 'jobs', 'bg', 'fg', 'nohup', 'screen', 'tmux',
                'chmod', 'chown', 'chgrp', 'umask', 'ln', 'touch', 'file', 'stat',
                'tar', 'gzip', 'gunzip', 'zip', 'unzip', 'wget', 'curl',
                'ssh', 'scp', 'rsync', 'ping', 'traceroute', 'netstat', 'ss',
                'df', 'du', 'mount', 'umount', 'lsblk', 'fdisk',
                'systemctl', 'service', 'crontab', 'history', 'alias', 'unalias',
                'echo', 'printf', 'read', 'export', 'env', 'printenv', 'set', 'unset',
                'exit', 'logout', 'su', 'sudo', 'whoami', 'id', 'groups',
                'vi', 'vim', 'nano', 'emacs', 'python', 'python3', 'node', 'npm', 'git',
                'docker', 'docker-compose', 'kubectl', 'helm'
            ];
            
            const matches = commonCommands.filter(cmd => cmd.startsWith(currentWord.toLowerCase()));
            
            if (matches.length === 1) {
                // í•˜ë‚˜ì˜ ë§¤ì¹˜ë§Œ ìˆìœ¼ë©´ ìë™ì™„ì„±
                const suggestion = matches[0];
                const beforeCurrentWord = textBeforeCursor.substring(0, textBeforeCursor.lastIndexOf(currentWord));
                input.value = beforeCurrentWord + suggestion + ' ' + textAfterCursor;
                
                // ì»¤ì„œë¥¼ ì™„ì„±ëœ ë‹¨ì–´ + ê³µë°± ëìœ¼ë¡œ ì´ë™
                const newPosition = beforeCurrentWord.length + suggestion.length + 1;
                input.setSelectionRange(newPosition, newPosition);
            } else if (matches.length > 1) {
                // ì—¬ëŸ¬ ë§¤ì¹˜ê°€ ìˆìœ¼ë©´ ê³µí†µ ì ‘ë‘ì‚¬ë¡œ ì™„ì„±í•˜ê³  ì˜µì…˜ í‘œì‹œ
                const commonPrefix = findCommonPrefix(matches);
                
                if (commonPrefix.length > currentWord.length) {
                    const beforeCurrentWord = textBeforeCursor.substring(0, textBeforeCursor.lastIndexOf(currentWord));
                    input.value = beforeCurrentWord + commonPrefix + textAfterCursor;
                    
                    const newPosition = beforeCurrentWord.length + commonPrefix.length;
                    input.setSelectionRange(newPosition, newPosition);
                }
                
                // í„°ë¯¸ë„ì— ì˜µì…˜ë“¤ í‘œì‹œ
                const output = document.getElementById('terminalOutput');
                output.textContent += `\n`;
                output.textContent += matches.join('  ') + '\n';
                output.scrollTop = output.scrollHeight;
            }
        }
        
        // ê³µí†µ ì ‘ë‘ì‚¬ ì°¾ê¸°
        function findCommonPrefix(strings) {
            if (strings.length === 0) return '';
            if (strings.length === 1) return strings[0];
            
            let commonPrefix = '';
            const firstString = strings[0];
            
            for (let i = 0; i < firstString.length; i++) {
                const char = firstString[i];
                if (strings.every(str => str[i] === char)) {
                    commonPrefix += char;
                } else {
                    break;
                }
            }
            
            return commonPrefix;
        }
        
        // í„°ë¯¸ë„ íƒ­ì´ ì—´ë¦´ ë•Œ ì„œë²„ ëª©ë¡ ë¡œë“œ
        function loadTerminalServers() {
            loadServers().then(servers => {
                const select = document.getElementById('terminalServerSelect');
                select.innerHTML = '<option value="">ì„œë²„ ì„ íƒ...</option>';
                
                servers.forEach(server => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(server);
                    option.textContent = `${server.description} (${server.host}:${server.port})`;
                    select.appendChild(option);
                });
            });
        }
        
        // ê¸°ì¡´ showTab í•¨ìˆ˜ ìˆ˜ì •í•˜ì—¬ í„°ë¯¸ë„ íƒ­ ì§€ì› ì¶”ê°€
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab(tabName);
            
            if (tabName === 'terminal') {
                loadTerminalServers();
            } else if (tabName === 'security') {
                loadSecurityStats();
            }
        };
        
        // ë³´ì•ˆ í†µê³„ ë¡œë“œ
        async function loadSecurityStats() {
            try {
                const response = await fetch('/ssh/security/stats/local');
                const data = await response.json();
                
                if (data.stats) {
                    const statsContent = document.getElementById('securityStatsContent');
                    const stats = data.stats;
                    
                    statsContent.innerHTML = `
<strong>ì „ì²´ ì°¨ë‹¨ëœ ëª…ë ¹ì–´:</strong> ${stats.total_blocked}ê°œ
<strong>ìµœê·¼ 24ì‹œê°„:</strong> ${stats.recent_24h}ê°œ

<strong>ì¹´í…Œê³ ë¦¬ë³„ ì°¨ë‹¨ í˜„í™©:</strong>
${Object.entries(stats.categories).map(([category, count]) => 
    `â€¢ ${getCategoryName(category)}: ${count}ê°œ`
).join('\n')}

<strong>ê°€ì¥ ë§ì´ ì°¨ë‹¨ëœ ëª…ë ¹ì–´ Top 5:</strong>
${stats.top_blocked_commands.slice(0, 5).map((item, index) => 
    `${index + 1}. "${item.command}" (${item.count}íšŒ)`
).join('\n')}
                    `;
                } else {
                    document.getElementById('securityStatsContent').textContent = data.error || 'í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                console.error('ë³´ì•ˆ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('securityStatsContent').textContent = 'í†µê³„ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        }
        
        // ë³´ì•ˆ ì´ë²¤íŠ¸ ë¡œë“œ
        async function loadSecurityEvents() {
            try {
                const response = await fetch('/ssh/security/events/local?limit=20');
                const data = await response.json();
                
                if (data.events && data.events.length > 0) {
                    const eventsContent = document.getElementById('securityEventsContent');
                    
                    eventsContent.innerHTML = data.events.map(event => `
<div style="border-bottom: 1px solid #eee; padding: 10px 0;">
    <strong>ì‹œê°„:</strong> ${new Date(event.timestamp).toLocaleString()}
    <strong>ëª…ë ¹ì–´:</strong> ${event.command}
    <strong>ì¹´í…Œê³ ë¦¬:</strong> ${getCategoryName(event.category)}
    <strong>ì°¨ë‹¨ ì‚¬ìœ :</strong> ${event.reason}
    ${event.session_id ? `<strong>ì„¸ì…˜ ID:</strong> ${event.session_id.substring(0, 8)}...` : ''}
</div>
                    `).join('');
                    
                } else {
                    document.getElementById('securityEventsContent').textContent = 'ì°¨ë‹¨ëœ ëª…ë ¹ì–´ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                console.error('ë³´ì•ˆ ì´ë²¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('securityEventsContent').textContent = 'ì´ë²¤íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        }
        
        // ë³´ì•ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testSecuritySystem() {
            try {
                const response = await fetch('/ssh/security/test/local', {method: 'POST'});
                const data = await response.json();
                
                if (data.test_results) {
                    const testResults = document.getElementById('securityTestResults');
                    
                    testResults.innerHTML = `
                        <div class="result-box success">
                            <h4>ğŸ§ª ë³´ì•ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h4>
                            <div class="result-content">
ì´ í…ŒìŠ¤íŠ¸: ${data.total_tested}ê°œ ëª…ë ¹ì–´
ì°¨ë‹¨ëœ ëª…ë ¹ì–´: ${data.blocked_count}ê°œ
í†µê³¼í•œ ëª…ë ¹ì–´: ${data.total_tested - data.blocked_count}ê°œ

<strong>í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìƒì„¸:</strong>
${data.test_results.map(result => 
    `â€¢ "${result.command}" â†’ ${result.is_dangerous ? 'ğŸš« ì°¨ë‹¨ë¨' : 'âœ… í—ˆìš©ë¨'}`
).join('\n')}
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('securityTestResults').innerHTML = `
                        <div class="result-box error">
                            <h4>í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h4>
                            <div class="result-content">${data.error || 'í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                document.getElementById('securityTestResults').innerHTML = `
                    <div class="result-box error">
                        <h4>í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜</h4>
                        <div class="result-content">ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
                    </div>
                `;
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ëª… ë³€í™˜
        function getCategoryName(category) {
            const categoryNames = {
                'destructive': 'ì‹œìŠ¤í…œ íŒŒê´´ì ',
                'privilege': 'ê¶Œí•œ ìƒìŠ¹',
                'network_attack': 'ë„¤íŠ¸ì›Œí¬ ê³µê²©',
                'malicious_download': 'ì•…ì„± ë‹¤ìš´ë¡œë“œ',
                'system_file': 'ì‹œìŠ¤í…œ íŒŒì¼ ì¡°ì‘',
                'process_kill': 'í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ',
                'scheduler': 'ìŠ¤ì¼€ì¤„ëŸ¬ ì¡°ì‘'
            };
            return categoryNames[category] || category;
        };
    </script>
</body>
</html>

